/*!
 * Library: singulum
 * Description: manage your JavaScript application state with predictability and minimal boilerplate
 * Author: Tony Quetano
 * License: MIT
 */
!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("singulum",[],n):"object"==typeof exports?exports.singulum=n():t.singulum=n()}(this,function(){return function(t){function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n,e){t.exports=e(1)},function(t,n,e){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(n,"__esModule",{value:!0});var i=e(2),o=r(i);n.default=new o.default,t.exports=n.default},function(t,n,e){"use strict";function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function i(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)}Object.defineProperty(n,"__esModule",{value:!0});var o=e(3),s=Object.assign,u=Object.keys,a=function(t,n,e){return t.$$store[n]=e,(0,o.isFunction)(t.$$listener)&&t.$$listener(t.store),e},c=function(t,n){return(0,o.bindFunction)(function(){for(var e=this,r=arguments.length,o=Array(r),s=0;r>s;s++)o[s]=arguments[s];var u=[this.$$store[n]].concat(o),c=t.apply(void 0,i(u));return c.then?c.then(function(t){return a(e,n,t)}):Promise.resolve(a(this,n,c))},this)},f=function(t,n,e){return(0,o.setReadonly)(t,n,new g(e)),t.$$store[n]=t[n],t[n]},l=function(t,n,e){if(!(0,o.isObject)(e))throw new Error("Must provide a map of leaves to branch.");t.$$initialValues[n]=(0,o.getClone)(e.initialValue,d),t.$$store[n]=(0,o.getClone)(e.initialValue,d),(0,o.forEach)(u(e),function(r){var i=e[r];"initialValue"!==r&&(0,o.isFunction)(i)&&(t.$$actions[r]=c.call(t,i,n))})},h=function b(t){return r(this,b),s(this,t),this},d=function p(t){var n=this;return r(this,p),(0,o.forEach)(u(t),function(e){var r=t[e];n[e]=r instanceof g?r.store:r}),this},$=function y(t,n,e){var i=this;return r(this,y),(0,o.forEach)(u(t),function(t){var r=n[t];r instanceof g&&e?i[t]=new y(r.store,r.$$store,e):i[t]=(0,o.getClone)(r,d)}),this},g=function m(){var t=this,n=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return r(this,m),(0,o.setHidden)(this,"$$actions",[]),(0,o.setHidden)(this,"$$initialValues",{}),(0,o.setHidden)(this,"$$listener",null),(0,o.setHidden)(this,"$$snapshots",{}),(0,o.setHidden)(this,"$$store",{}),(0,o.forEach)(u(n),function(e){l(t,e,n[e])}),this};g.prototype=Object.create({get actions(){return new h(this.$$actions)},get store(){return new d(this.$$store)},branch:function(t,n){if(!(0,o.isString)(t))throw new Error("The first argument to singulum.branch must be a string.");return n?f(this,t,n):this[t]},branches:function v(t){var n=this,v=[];return(0,o.isArray)(t)?(t.forEach(function(t){(0,o.isString)(t)&&v.push(n[t])}),v):((0,o.forEach)(u(t),function(e){v.push(f(n,e,t[e]))}),v)},reset:function(){var t=this,n=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return(0,o.forEach)(u(this.$$store),function(e){var r=t.$$store[e];r instanceof g&&n?r.reset():r instanceof $||(t.$$store[e]=t.$$initialValues[e])}),(0,o.isFunction)(this.$$listener)&&this.$$listener(this.store),this},restore:function(t){var n=this,e=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];if(!(t instanceof $))throw new Error("Snapshot used in restore method must be a SingulumSnapshot.");return(0,o.forEach)(Object.keys(t),function(r){var i=t[r];i instanceof $&&e?n.$$store[r].restore(i,e):i instanceof d||(n.$$store[r]=i)}),(0,o.isFunction)(this.$$listener)&&this.$$listener(this.store),this},snapshot:function(){var t=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return new $(this.store,this.$$store,t)},unwatch:function(){return this.$$listener=null,this},watch:function(t){return(0,o.isFunction)(t)&&(this.$$listener=t),this}}),n.default=g,t.exports=n.default},function(t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},r=Object.prototype.toString,i=n.bindFunction=function(t,n){return function(){for(var e=arguments.length,r=Array(e),i=0;e>i;i++)r[i]=arguments[i];return t.apply(n,r)}},o=n.forEach=function(t,n){for(var e=0,r=t.length;r>e;e++)n(t[e],e,t)},s=n.isArray=function(t){return"[object Array]"===r.call(t)},u=n.isDate=function(t){return"[object Date]"===r.call(t)},a=n.isFunction=function(t){return"[object Function]"===r.call(t)||"function"==typeof t},c=n.isObject=function(t){return"[object Object]"===r.call(t)&&!!t},f=n.isString=function(t){return"[object String]"===r.call(t)},l=n.isUndefined=function(t){return void 0===t},h=n.getClone=function g(t,n){if(s(t))return t.map(function(t){return g(t,n)});if(c(t)){var r=function(){var e={};return Object.keys(t).forEach(function(r){var i=t[r];e[r]=g(i,n)}),t instanceof n&&(e=new n(e)),{v:e}}();if("object"===("undefined"==typeof r?"undefined":e(r)))return r.v}return u(t)?new Date(t.valueOf()):t},d=n.setHidden=function(t,n,e){Object.defineProperty(t,n,{configurable:!0,enumerable:!1,value:e,writable:!0})},$=n.setReadonly=function(t,n,e){Object.defineProperty(t,n,{get:function(){return e},set:function(){throw new Error("Cannot set a value for "+n+", as it is immutable.")}})};n.default={bindFunction:i,forEach:o,getClone:h,isArray:s,isDate:u,isFunction:a,isObject:c,isString:f,isUndefined:l,setHidden:d,setReadonly:$}}])});